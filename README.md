# Файловый менеджер: Серверная часть

Серверная часть файлового менеджера, предоставляющая REST API для работы с файлами.

## Установка

```bash
npm install
```

## Запуск

Запуск в обычном режиме:

```bash
npm start
```

Запуск в режиме разработки (с автоматической перезагрузкой):

```bash
npm run dev
```

## Тестирование

### Запуск тестов

Для запуска всех тестов:

```bash
npm run test
```

Для запуска тестов в режиме наблюдения:

```bash
npm run test:watch
```

Для запуска конкретного файла:

```bash
npx vitest run src/__tests__/путь/к/файлу.test.ts
```

### Визуализация результатов тестирования

Проект настроен для красивого отображения результатов тестов. Доступны следующие варианты:

1. **Подробный вывод в консоли**

Тесты запускаются с verbose репортером, который показывает подробную структуру тестов:

```bash
npm run test
```

2. **HTML-отчет**

После запуска тестов автоматически создается HTML-отчет, доступный по пути `html/test-report.html`

Чтобы просмотреть отчет в браузере:

```bash
npx vite preview --outDir html
```

3. **Интерактивный UI**

Для запуска тестов с интерактивным пользовательским интерфейсом:

```bash
npm run test:ui
```

Это запустит Vitest UI интерфейс, который будет доступен по адресу http://localhost:51204/**vitest**/

### Текущее состояние тестов

Проект использует Vitest в качестве фреймворка для тестирования. Все тесты проходят успешно, включая:

- Утилиты (`file.utils.test.ts`, `disk.utils.test.ts`)
- Конфигурация (`config.test.ts`)
- Маршруты (`file.routes.test.ts`)
- Серверные компоненты (`server.test.ts`)
- Контроллеры диска (`disk.controller.test.ts`)
- Контроллеры файлов (`file.controller.test.ts`)
- Контроллеры загрузки (`upload.controller.test.ts`)

### Особенности тестирования

Для тестирования файловой системы используется библиотека mock-fs, которая позволяет эмулировать файловую систему без реального создания файлов. Особенности использования:

1. При настройке mock-fs важно сохранять доступ к node_modules:

```typescript
mockFs({
	[TEST_UPLOADS_DIR]: {
		// Файлы тестовой директории
	},
	node_modules: mockFs.load(path.resolve(process.cwd(), 'node_modules')),
})
```

2. После каждого теста необходимо восстанавливать исходное состояние файловой системы:

```typescript
afterEach(() => {
	mockFs.restore()
})
```

3. Для тестирования загрузки файлов используется специальный middleware, который эмулирует работу multer.

## API

Сервер предоставляет следующие конечные точки:

### Получение списка файлов

```
GET /api/files?path=/путь/к/директории
```

### Загрузка файла

```
POST /api/upload?path=/путь/к/директории
```

### Создание директории

```
POST /api/directory
```

Тело запроса:

```json
{
	"path": "/путь/к/родительской/директории",
	"name": "имя_новой_директории"
}
```

### Удаление файла или директории

```
DELETE /api/delete/:id?path=/путь/к/файлу
```

### Переименование файла или директории

```
PUT /api/rename/:id?path=/старое/имя&dir=/директория
```

Тело запроса:

```json
{
	"newName": "новое_имя"
}
```

## Конфигурация

Сервер работает на порте 3000 по умолчанию. Вы можете изменить порт, установив переменную окружения `PORT`:

```bash
PORT=4000 npm start
```
